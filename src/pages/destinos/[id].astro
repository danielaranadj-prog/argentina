---
import { getCollection } from 'astro:content';
import Layout from '../../layouts/Layout.astro'; 
import Navbar from '../../components/Navbar.astro';
import FlightSearch from '../../components/FlightSearch.astro';
import HotelWidget from '../../components/HotelWidget.astro';
import AdsenseWidget from '../../components/AdsenseWidget.astro';
import FAQ from '../../components/FAQ.astro';
import LeadMagnet from '../../components/LeadMagnet.astro';

// 1. Generamos las rutas leyendo la carpeta "content/destinos"
export async function getStaticPaths() {
  const destinos = await getCollection('destinos');
  
  return destinos.map((destino) => ({
    params: { id: destino.slug },
    props: { destino },
  }));
}

// 2. Extraemos los datos y renderizamos el contenido
const { destino } = Astro.props;
const { Content } = await destino.render(); // Aquí se procesa el texto largo (Markdown)
const { title, img, desc, historia, secciones, tours, faqs, leadMagnet } = destino.data;
---

<Layout title={`${title} | Destinos Argentinos`}>
  <Navbar />
  
  <header class="dest-hero" style={`background-image: url(${img})`}>
    <div class="overlay"></div>
    <div class="hero-text">
      <h1>{title}</h1>
      <p class="slogan">{desc}</p>
    </div>
  </header>

  <main class="container">
    <div class="nav-back">
      <a href="/argentina/#destinos" class="back-link">
        <i class="fas fa-chevron-left"></i> VOLVER A DESTINOS
      </a>
    </div>

    <article class="main-info">
      <div class="text-block">
        <h2>La Experiencia</h2>
        <p>{historia}</p>
      </div>

      <div class="icon-grid">
        {secciones.map((sec) => (
          <div class="icon-item">
            <div class="icon-wrapper">
              <i class={`fas ${sec.icon}`}></i>
            </div>
            <div class="icon-content">
              <h3>{sec.label}</h3>
              <p>{sec.text}</p>
            </div>
          </div>
        ))}
      </div>
    </article>

    <!-- Anuncio entre secciones -->
    <AdsenseWidget slot="inline" />

    <section class="destination-content">
        <Content />
    </section>

    <!-- Lead Magnet Section (optional) -->
    {leadMagnet && (
      <LeadMagnet leadMagnet={leadMagnet} destinoTitle={title} />
    )}

    <!-- FAQ Section (optional) -->
    {faqs && faqs.length > 0 && (
      <FAQ faqs={faqs} destinoTitle={title} />
    )}

    {tours && tours.length > 0 && (
      <section class="tours-section">
        <div class="section-header">
          <h2>Experiencias Imperdibles</h2>
          <span class="badge">Reservar</span>
        </div>

        <div class="scroll-container">
          {tours.map((tour) => (
            <a href={tour.link} target="_blank" rel="noopener noreferrer" class="tour-card">
              <div class="card-image" style={`background-image: url('${tour.imagen}')`}>
                <div class="card-overlay">
                  <span class="duration-tag"><i class="far fa-clock"></i> {tour.duracion}</span>
                </div>
              </div>
              <div class="card-info">
                <h3>{tour.titulo}</h3>
                <div class="card-footer">
                  <span class="price">{tour.precio}</span>
                  <span class="btn-reservar">Ver <i class="fas fa-chevron-right"></i></span>
                </div>
              </div>
            </a>
          ))}
        </div>
        
        <p class="disclaimer-text">
          *Actividades operadas por guías locales verificados.
        </p>
      </section>
    )}

    <!-- Travel Widgets Section -->
    <section class="travel-widgets-section">
      <div class="section-header">
        <h2>Planifica tu Viaje</h2>
        <span class="badge">Reservar</span>
      </div>
      <div class="travel-widgets">
        <FlightSearch defaultDestination={title} />
        <HotelWidget defaultDestination={title} />
      </div>
      
      <!-- Anuncio al final de la sección de widgets -->
      <AdsenseWidget slot="inline" className="mt-ads" />
    </section>
  </main>
</Layout>

<style>
  /* --- HERO & GENERAL --- */
  .dest-hero {
    height: 45vh;
    background-size: cover;
    background-position: center;
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
    text-align: center;
    color: white;
    padding-top: 60px;
  }
  .overlay { position: absolute; inset: 0; background: rgba(0,0,0,0.45); }
  .hero-text { position: relative; z-index: 2; padding: 0 20px; }
  
  .hero-text h1 { 
      font-size: clamp(2.5rem, 6vw, 4rem); 
      font-style: normal;
      margin: 15px 0; 
      font-weight: 700;
      letter-spacing: -1px; 
      text-transform: uppercase;
      text-shadow: 0 2px 10px rgba(0,0,0,0.5);
      color: #ffffff !important;
  }

  .slogan { 
      font-size: 0.9rem;
      font-weight: 300;
      letter-spacing: 1px;
      text-transform: uppercase;
      opacity: 0.9;
      margin-top: 10px;
      color: #ffffff !important;
      text-shadow: 0 2px 10px rgba(0,0,0,0.5);
  }
  
  .container { max-width: 900px; margin: 0 auto; padding: 40px 20px; }
  .nav-back { margin-bottom: 40px; }
  .back-link { font-size: 0.75rem; color: var(--gold); letter-spacing: 2px; font-weight: 700; display: flex; align-items: center; gap: 8px; text-decoration: none; }

  .text-block { margin-bottom: 50px; }
  .text-block h2 { 
      font-size: 2rem; 
      margin-bottom: 15px; 
      font-weight: 600;
      font-style: normal;
      letter-spacing: -0.5px; 
      color: var(--title);
  }
  
  /* --- JUSTIFICACIÓN 1: TEXTO PRINCIPAL --- */
  .text-block p { 
      font-weight: 400; 
      color: var(--text-secondary); 
      line-height: 1.8; 
      font-size: 1rem;
      text-align: justify; /* Justificado */
      text-wrap: pretty;
  }

  /* --- GRID DE ICONOS --- */
  .icon-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 35px;
    margin-top: 40px;
    margin-bottom: 60px;
  }
  .icon-item { display: flex; gap: 18px; align-items: flex-start; }
  .icon-wrapper {
    width: 45px;
    height: 45px;
    display: flex;
    align-items: center;
    justify-content: center;
    border: 1px solid var(--border);
    border-radius: 12px;
    flex-shrink: 0;
    background: var(--bg-secondary); 
  }
  .icon-wrapper i { color: var(--gold); font-size: 1.1rem; }
  
  .icon-content h3 { 
      font-size: 0.85rem; 
      letter-spacing: 1px; 
      text-transform: uppercase; 
      margin-bottom: 6px; 
      font-weight: 700;
      color: var(--title);
  }
  
  /* --- JUSTIFICACIÓN 2: ICONOS --- */
  .icon-content p { 
      font-size: 0.9rem; 
      font-weight: 400; 
      color: var(--text-secondary); 
      margin: 0; 
      line-height: 1.6;
      text-align: justify; /* Justificado */
      hyphens: auto; /* Evita huecos grandes */
  }

  @media (max-width: 600px) {
    .icon-grid { grid-template-columns: 1fr; gap: 25px; }
    .hero-text h1 { font-size: 2.8rem; }
  }

  /* --- TOURS SECTION --- */
  .tours-section { border-top: 1px solid var(--border); padding-top: 40px; }
  .section-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; padding: 0 5px; }
  .section-header h2 { font-size: 1.5rem; color: var(--title); font-weight: 700; margin: 0; font-family: 'Montserrat', sans-serif; }
  .badge { background: var(--gold); color: #fff; font-size: 0.7rem; padding: 5px 10px; border-radius: 20px; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; }

  .scroll-container {
    display: flex;
    gap: 20px;
    overflow-x: auto;
    padding-bottom: 25px;
    padding-left: 5px; 
    padding-right: 20px;
    -webkit-overflow-scrolling: touch;
    scroll-snap-type: x mandatory;
    scrollbar-width: none;
  }
  .scroll-container::-webkit-scrollbar { display: none; }

  .tour-card {
    flex: 0 0 260px;
    height: 320px;
    background: var(--card-bg);
    border-radius: 18px;
    overflow: hidden;
    scroll-snap-align: center;
    box-shadow: 0 4px 20px rgba(0,0,0,0.06);
    border: 1px solid var(--border);
    display: flex;
    flex-direction: column;
    text-decoration: none;
    transition: transform 0.2s ease;
  }
  .tour-card:active { transform: scale(0.98); }

  .card-image { height: 55%; background-size: cover; background-position: center; position: relative; }
  .duration-tag { position: absolute; top: 10px; left: 10px; background: rgba(0,0,0,0.6); backdrop-filter: blur(4px); -webkit-backdrop-filter: blur(4px); color: white; padding: 4px 10px; border-radius: 8px; font-size: 0.7rem; font-weight: 600; }

  .card-info { padding: 16px; display: flex; flex-direction: column; justify-content: space-between; height: 45%; }
  .card-info h3 { font-size: 1.05rem; margin: 0 0 5px 0; color: var(--title); font-weight: 700; line-height: 1.3; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }

  .card-footer { display: flex; justify-content: space-between; align-items: center; margin-top: auto; }
  .price { font-size: 1.1rem; font-weight: 800; color: var(--text-secondary); }
  
  .btn-reservar { background: var(--text); color: var(--bg); padding: 6px 12px; border-radius: 20px; font-size: 0.75rem; font-weight: 600; display: flex; align-items: center; gap: 4px; transition: opacity 0.2s; }
  .btn-reservar:hover { opacity: 0.8; }

  .disclaimer-text { font-size: 0.7rem; color: var(--text-secondary); text-align: center; margin-top: 25px; opacity: 0.6; letter-spacing: 0.5px; }

  @media (min-width: 768px) {
    .tour-card { flex: 0 0 280px; }
  }

  /* ================================================= */
  /* ESTILOS PARA EL CONTENIDO DEL BLOG (.md)         */
  /* ================================================= */
  .destination-content {
    max-width: 800px;
    margin: 40px auto 80px auto;
    font-size: 1.1rem;
    line-height: 1.8;
    color: var(--text);
  }

  /* Títulos del blog: Semi-Bold (600) en vez de Bold (700) */
  .destination-content :global(h2), 
  .destination-content :global(h3) {
    color: var(--title);
    font-family: 'Montserrat', sans-serif;
    margin-top: 40px;
    margin-bottom: 20px;
    font-weight: 600; 
  }
  
  .destination-content :global(h2) { font-size: 1.8rem; }
  .destination-content :global(h3) { font-size: 1.4rem; }

  .destination-content :global(ul), 
  .destination-content :global(ol) {
    padding-left: 20px;
    margin-bottom: 25px;
    color: var(--text-secondary);
  }

  /* --- JUSTIFICACIÓN 3: BLOG Y LISTAS --- */
  .destination-content :global(li) {
    margin-bottom: 10px;
    text-align: justify; /* Justificado */
  }
  
  .destination-content :global(p) {
    margin-bottom: 20px;
    text-align: justify; /* Justificado */
  }

  .destination-content :global(strong) {
    color: var(--title);
    font-weight: 700;
  }
  
  .destination-content :global(blockquote) {
    border-left: 4px solid var(--gold);
    padding-left: 20px;
    margin: 30px 0;
    font-style: italic;
    color: var(--text-secondary);
    background: var(--bg-secondary); /* Fondo sutil */
    padding: 15px 20px;
    border-radius: 0 10px 10px 0;
  }

  /* --- TRAVEL WIDGETS SECTION --- */
  .travel-widgets-section {
    border-top: 1px solid var(--border);
    padding-top: 40px;
    margin-top: 40px;
  }

  .travel-widgets {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 1.5rem;
    margin-top: 1.5rem;
  }

  @media (max-width: 600px) {
    .travel-widgets {
      grid-template-columns: 1fr;
    }
  }

  /* Margin for ads */
  .mt-ads {
    margin-top: 2rem;
  }
</style>